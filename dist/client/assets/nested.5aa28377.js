var p=Object.defineProperty;var L=(i,e,t)=>e in i?p(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>(L(i,typeof e!="symbol"?e+"":e,t),t);import{a as P}from"./index.a2e70da6.js";class j extends HTMLCanvasElement{constructor(){super();u(this,"ctx");u(this,"img");u(this,"cartelPadding");this.ctx=this.getContext("2d"),this.img=new Image,this.cartelPadding=32}_loadImage(){const t=this.getAttribute("img");t&&(this.img.src!==t?(this.img.crossOrigin="anonymous",this.img.src=t,this.img.onload=()=>{this._draw()}):this._draw())}_img(t,s){const o=t/s,n=this.img.width/this.img.height,c=n<o?n*s:t,d=n>=o?this.img.height/this.img.width*t:s;return{width:c,height:d,drawImg:(g,f)=>{this.ctx.drawImage(this.img,g,f,c,d)}}}_cartel(){const t=this.getAttribute("artiste"),s=this.getAttribute("titre"),o=this.getAttribute("date"),n=this.getAttribute("medium"),c=this.getAttribute("dimensions"),d=this.getAttribute("localisation"),m=[t,s,o,n,c,d].filter(h=>h!==null&&h!==""),g=30;this.ctx.strokeStyle="#ffffff",this.ctx.font=`${g}px Roboto`,this.ctx.fillStyle="#fff";const f=m.reduce((h,w)=>Math.max(this.ctx.measureText(w||"").width,h),0)+this.cartelPadding*2,I=(m.length-1)*g+this.cartelPadding*2;return{draw:(h,w)=>{m.forEach((_,S)=>{this.ctx.fillText(_||"",h+this.cartelPadding,w+this.cartelPadding+S*g)})},width:f,height:I}}_clearCanvas(){this.ctx.fillStyle="#010923",this.ctx.fillRect(0,0,this.width,this.height)}_draw(){this._clearCanvas();const t=this._cartel(),s=this._img(this.width-t.width,this.height),o=Math.floor((this.width-s.width-t.width)*.5),n=Math.floor((this.height-s.height)*.5);s.drawImg(o,n),t.draw(o+s.width,n+s.height-t.height)}refresh(){this._loadImage()}download(){const t=this.getAttribute("titre"),o=[this.getAttribute("artiste")||"anonyme",t||"sans-titre"].join("-"),n=document.createElement("a");n.download=o+".png",n.href=this.toDataURL(),n.click()}}const k=["artiste","titre","date","medium","dimensions","localisation"],a=document.getElementById("slide-js"),b=document.getElementById("export-js"),y=document.getElementById("prevBtn-js"),x=document.getElementById("nextBtn-js"),v=document.querySelector("body > main > form"),E=document.getElementById("loader-js"),A=v==null?void 0:v.querySelectorAll("input");let l,r=0;(async function(){const i=window.location.search,e=new URLSearchParams(i),t=e.get("id"),s=e.get("search");(t||s)&&R({id:t,toSearch:s})})();async function R({id:i,toSearch:e}){const t=i?`/api/infos/byid/${i}`:`/api/infos/bytitle/${e}`,o=(await P.get(t)).data;l=o.images;const n=l[r].source;if(a&&n){E&&(E.className="lds-ellipsis-inactive"),a.setAttribute("img",n);for(const c of k)if(o[c]){a.setAttribute(c,o[c]);const d=document.querySelector("#"+c);d&&(d.value=o[c])}a.refresh()}}b==null||b.addEventListener("click",i=>{i.preventDefault(),a.download()});x==null||x.addEventListener("click",i=>{r=(r+1)%l.length;const e=l[r].source;a.setAttribute("img",e),a.refresh()});y==null||y.addEventListener("click",i=>{r=r>0?r-1:l.length-1;const e=l[r].source;a.setAttribute("img",e),a.refresh()});A==null||A.forEach(i=>{i.addEventListener("input",e=>{const t=e.target;console.log(t.value,t.id),a.setAttribute(t.id,t.value),a.refresh()})});customElements.define("slide-view",j,{extends:"canvas"});
